<!DOCTYPE html>
<html lang="en">
<head>

     <title>新增上傳功能</title>
<!--

DIGITAL TREND

https://templatemo.com/tm-538-digital-trend

-->
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta name="description" content="">
     <meta name="keywords" content="">
     <meta name="author" content="">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

     {% load static %}
     <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
     <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
     <link rel="stylesheet" href="{% static 'css/aos.css' %}">
     <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}">
     <link rel="stylesheet" href="{% static 'css/owl.theme.default.min.css' %}">

     <!-- MAIN CSS -->
     <link rel="stylesheet" href="{% static 'css/templatemo-digital-trend.css' %}">

</head>
<body>

     <!-- MENU BAR -->
    <nav class="navbar navbar-expand-lg position-absolute">
        <div class="container">
            <a class="navbar-brand" href="/index">
              新增上傳功能
            </a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                  {% if request.user.is_authenticated %}    
                  <li class="nav-item dropdown">  <!-- 加上 dropdown, 表示擁有下一層收合展開的子選單 ********** -->
                    <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      會員功能
                    </button>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">  <!-- 子選單的 div ********** -->
                      <a class="dropdown-item" href="\add">新增</a>
                      <a class="dropdown-item" href="\user_blog">點位管理</a>
                      <a class="dropdown-item" href="\logout">登出</a>
                    </div>
                  </li>
                  {% endif %}
                </ul>
            </div>
        </div>
    </nav>


     <!-- CONTACT -->
     <section class="contact section-padding">
          <div class="container">
               <div class="row">
                      <form action="" method="post" class="contact-form" data-aos="fade-up" data-aos-delay="300" role="form" enctype="multipart/form-data">
                      {% csrf_token %}
                      <div class="col-lg-8 mx-auto col-md-10 col-12">

  
                        <input id="avatar" type="hidden" value="/static/images/sample.png" name="purl"> {# 實際應用中要將該input標籤隱藏，display:none; #}             
                      <!-- Follow https://templatemo.com/contact page to setup your own contact form -->
                    

                        <div class="row">
                          <div class="col-lg-12 col-12">
                            <input type="text" class="form-control" name="title" placeholder="地點名稱" required>
                          </div>

                          <div class="col-lg-12 col-12">
                            <textarea maxlength="40" class="form-control" rows="6" name="content" placeholder="詳細介紹(最多只能輸入40個字！)" required></textarea>
                          </div>

                          <div class="col-lg-12 col-12">
                            <input id= "lat" class="form-control" rows="6" name="lat" placeholder="緯度" type = "number" step="any" min="-180" max="180" required>
                          </div>

                          <div class="col-lg-12 col-12">
                            <input id= "lon" class="form-control" rows="6" name="lon" placeholder="經度" type = "number" step="any" min="-180" max="180" required>
                          </div>

                          <div class="col-lg-7 col-12">
                            <select type="selection" id="select-button" name = "type">
                                {% for item in all%}
                                  <option>{{ item.title }}</option>
                                {% empty %}
                                  <option>種類選擇</option>
                                  <option>建屋</option>
                                  <option>植物</option>
                                  <option>動物</option>
                                {% endfor %}
　　　　　　　　　　　　　　　</select> 
                          </div>

                          <div class="col-lg-5 mx-auto col-7">
                            <button type="submit" class="form-control" id="submit-button" name="submit">新增點位</button>
                          </div>
                        </div>

                      </form>
                      <div class="col-lg-12 mx-auto col-md-7 col-12 mb-4">
                        <div class="blog-header" data-aos="fade-up" data-aos-delay="100">
                          <img id= "avatarPreview" src="{% static 'images/box.png' %}" class="img-fluid" alt="blog header">

                          <div class="blog-header-info">
                            <h3>
                              <label class="btn btn-info">
                                <input id="avatarSlect" style="display:none;" type="file" name = "avaurl" required>
                                <i class="fa fa-photo"></i> 上傳圖片
                              </label>
                            </h3>
                          </div>
                        </div>
                      </div>   
                    </div>

               </div>
          </div>
     </section>

<!-- How to change your own map point
	1. Go to Google Maps
	2. Click on your location point
	3. Click "Share" and choose "Embed map" tab
	4. Copy only URL and paste it within the src="" field below
-->



     <!-- SCRIPTS -->
     <script src="{% static 'js/jquery.min.js' %}"></script>
     <script src="{% static 'js/bootstrap.min.js' %}"></script>
     <script src="{% static 'js/aos.js' %}"></script>
     <script src="{% static 'js/owl.carousel.min.js' %}"></script>
     <script src="{% static 'js/smoothscroll.js' %}"></script>
     <script src="{% static 'js/custom.js' %}"></script>
     <script>
        $("#avatarSlect").change(function () {
          var csrf = $("input[name='csrfmiddlewaretoken']").val();
          var formData=new FormData();
          formData.append("csrfmiddlewaretoken",csrf);
          formData.append('avatar', $("#avatarSlect")[0].files[0]);  /*獲取上傳的圖片物件*/
          $.ajax({
            url: '/upload_avatar/',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            success: function (args) {
              console.log(args);  /*伺服器端的圖片地址*/
              console.log(args['basename'])
              $("#avatarPreview").attr('src', `/media/preImg/${args['basename']}`);  /*預覽圖片*/
              $("#avatar").val(args['basename']);  /*將服務端的圖片url賦值給form表單的隱藏input標籤*/
              $("#lon").val(args['lon']);
              $("#lat").val(args['lat']);             
            },            
          })
      }); 
     </script>

</body>
</html>